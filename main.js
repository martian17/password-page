let encrypted = "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";


//How to encrypt
//CryptoJS.AES.encrypt(JSON.stringify({message:"message"}),pass).toString();


let Pause = function(t){
    return new Promise((res,rej)=>{
        setTimeout(res,t);
    });
};

let Popup = function(elem){
    this.hidden = true;
    elem.e.classList.add("popup");
    elem.e.classList.add("invisible");
    this.hide = async function(){
        this.hidden = true;
        elem.e.classList.remove("visible");
        elem.e.classList.add("invisible");
    };
    this.show = async function(){
        console.log(this.hidden);
        if(!this.hidden){
            elem.e.classList.remove("visible");
            elem.e.classList.add("invisible");
            await Pause(100);//wait 100 ms
        }
        this.hidden = false;
        elem.e.classList.remove("invisible");
        elem.e.classList.add("visible");
    }
};


let main = function(){
    let body = new ELEM(document.body);
    
    let wrapper = body.add("div","class:contentWrapper").add("div","class:wrapper");
    wrapper.add("h2",false,"Password protected page");
    wrapper.add("h3",false,"Please enter the password below to view the page content");
    let inputArea = wrapper.add("div","class:inputArea");
    let decryptSequence;
    let listeners = [];
    let input = inputArea.add("input","type:password;placeholder:Enter password here");
    listeners.push(input.on("keydown",function(e){
        if(e.key === "Enter"){
            decryptSequence();
        }
    }));
    listeners.push(inputArea.add("input","type:button;value:Enter").on("click",function(){
        decryptSequence();
    }));
    inputArea.add("label",false,"hide password");
    inputArea.add("input","type:checkbox;checked:true;").on("input",function(e){
        if(this.checked){
            input.e.setAttribute("type","password");
        }else{
            input.e.setAttribute("type","text");
        }
    });
    
    let popuparea = wrapper.add("div","class:popuparea");
    let accessDenied = new Popup(popuparea.add("div","class:accessDenied","Wrong passphrase: Access Denied"));
    let accessGranted = new Popup(popuparea.add("div","class:accessGranted","Correct passphrase: Access Granted"));
    
    let resultContainer = wrapper.add("div");
    wrapper.add("div","class:footer",
        "This page is protected by <a href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\">AES</a> encryption, powered by <a href=\"https://cryptojs.gitbook.io/\">CryptoJS</a><br>"+
        "Code: <a href=\"https://github.com/martian17/password-page\">https://github.com/martian17/password-page</a>"
    );
    
    decryptSequence = function(){
        let password = input.e.value;
        let decrypted;
        let obj;
        try{
            decrypted = CryptoJS.AES.decrypt(encrypted, password).toString(CryptoJS.enc.Utf8);
            obj = JSON.parse(decrypted);
        }catch(err){
            accessDenied.show();
            return false;
        }
        accessDenied.hide();
        accessGranted.show();
        //if no error, decrypt success, correct password
        //remove listeners
        listeners.map(l=>l.remove());
        resultContainer.add("h1",false,"Secret text");
        resultContainer.add("p",false,obj.message);
    };
};

main();